var oldPage,jsl,ready,stopXhr,http,main;oldPage=oldPage||(function(){"use strict";var lib,oldpageClass,oldJsLocked,timers,xhrs,handlers,clickedBtn;lib={};oldpageClass="oldpage";timers=[];xhrs=[];handlers=[];oldJsLocked=false;clickedBtn={};function changePage(params){main.changePage(null,null,false,params);}
function executeIfNotLocked(fn){return function(){if(!oldJsLocked&&typeof fn==='function'){return fn();}};}
function stopTimers(){oldJsLocked=true;while(timers.length>0){clearTimeout(timers.shift());}}
function stopXhrs(){oldJsLocked=true;while(xhrs.length>0){stopXhr(xhrs.shift());}}
function unloadScripts(){stopXhrs();stopTimers();jsl.removeElements(jsl.find("script."+oldpageClass,document.head));ready.reset();}
function unloadCss(){var selector;selector=["link."+oldpageClass,"style."+oldpageClass];jsl.removeElements(jsl.find(selector.join(","),document.head));}
function loadDelayed(script){var limit,poll;limit=20;poll=100;(function f(){if(limit<=0||Boolean(jsl.get("domReady"))){document.head.appendChild(script);ready.run();}else{limit=limit-1;setTimeout(f,poll);}}());}
function extractAndLoadScripts(content){var inlineScriptContent,scriptList,scripts;inlineScriptContent=[];scripts=[];scriptList=jsl.find("script",content);scriptList.forEach(function(script){var src,newScript;src=script.src;if(src){newScript=document.createElement("script");newScript.className=oldpageClass;newScript.src=src;scripts.push(newScript);}else{inlineScriptContent.push(script.textContent||"");}});jsl.removeElements(scriptList);if(inlineScriptContent.length>0){scripts.inline=document.createElement("script");scripts.inline.className=oldpageClass;scripts.inline.textContent=inlineScriptContent.join("\n");}
oldJsLocked=false;(function loadNext(){var script;if(scripts.length>0){script=scripts.shift();script.onload=loadNext;script.onerror=loadNext;document.head.appendChild(script);}else if(scripts.inline){loadDelayed(scripts.inline);}}());}
function extractAndLoadCss(content){var cssList,styleContent,newStyle;cssList=jsl.find("link[rel=stylesheet]",content);cssList.forEach(function(css){if(css.href){css.className=oldpageClass;document.head.appendChild(css);}});styleContent=[];cssList=jsl.find("style",content);cssList.forEach(function(css){styleContent.push(css.textContent||"");});jsl.removeElements(cssList);if(styleContent.length>0){newStyle=document.createElement("style");newStyle.className=oldpageClass;newStyle.textContent=styleContent.join("\n");document.head.appendChild(newStyle);}}
function decodeUrlObj(urlObj){var params;urlObj=urlObj||{};urlObj.page=decodeURI(urlObj.page||"");params={};Object.keys(urlObj.params||{}).forEach(function(name){var value;value=urlObj.params[name];params[decodeURIComponent(name)]=decodeURIComponent(value);});urlObj.params=params;if(urlObj.anchor){urlObj.anchor=decodeURIComponent(urlObj.anchor);}
return urlObj;}
function splitHref(url){return decodeUrlObj(http.splitUrl(url));}
function addHandler(obj,event,handler){obj.addEventListener(event,handler,false);handlers.push({obj:obj,event:event,handler:handler});}
function removeHandlers(){var handler,elem;while(handlers.length>0){handler=handlers.shift();if(handler.obj){elem=jsl.get(handler.obj);if(elem&&elem.removeEventListener){elem.removeEventListener(handler.event,handler.handler,false);}}}}
function readValue(el){switch(el.type||""){case'button':case'submit':break;case'file':break;case'checkbox':if(el.checked){return el.value||"on";}
break;case'radio':if(el.checked){return el.value||"";}
break;default:return el.value||"";}
return null;}
function readForm(form,addParams){var elems,result,el,name,value,i,len;elems=(form&&form.elements)||[];result={};for(i=0,len=elems.length;i<len;i=i+1){el=elems[i];name=el.name;if(name&&!el.disabled){value=readValue(el);if(value!==null){result[name]=value;}}}
if(addParams){for(name in addParams){if(addParams.hasOwnProperty(name)){result[name]=addParams[name]||"";}}}
return result;}
function onFormClick(evt){var btn;clickedBtn={};btn=jsl.eventTarget(evt,"button,input");if(btn&&btn.type==="submit"){clickedBtn.name=btn.name;clickedBtn.value=btn.value;}}
function onFormSubmit(evt){var form,action,data;form=jsl.eventTarget(evt,"form");if(!form.onsubmit&&!evt.defaultPrevented){action=splitHref(form.getAttribute("action"));if(clickedBtn.name){action.params[clickedBtn.name]=clickedBtn.value;}
action.params.oldpage=action.page;data=readForm(form,action.params);changePage(data);clickedBtn={};}
return jsl.cancelEvent(evt);}
function addFormHandler(content){jsl.find("form",content).forEach(function(form){var action;action=form.getAttribute("action");if(action.indexOf("/cgi-bin/firmwarecfg")<0){addHandler(form,"click",onFormClick);addHandler(form,"submit",onFormSubmit);}});}
function ignoreLink(link){var href,target;if(jsl.hasClass(link,"download")){return true;}
href=link.getAttribute("href");target=link.target;if(target==="_blank"){return true;}
if(/^\s*$/.test(href)){return true;}
if(/^javascript:/.test(href)){return true;}
if(/^#/.test(href)){return true;}
if(/^\/nas/.test(href)){return true;}
if(/^\/help\/help\.lua/.test(href)){return true;}
if(!/^\//.test(href)){return true;}
return false;}
function onLinkClick(evt){var link;link=jsl.eventTarget(evt,"a");if(link&&!ignoreLink(link)){if(!evt.defaultPrevented){lib.submitLink(link.getAttribute("href"));}
return jsl.cancelEvent(evt);}}
function addLinkHandler(content){addHandler(content,"click",onLinkClick);}
lib.jsLocked=function(){return oldJsLocked;};lib.unLockJs=function(){oldJsLocked=false;return oldJsLocked;};lib.registerEventHandler=function(idOrElement,event,handler){handlers.push({obj:idOrElement,event:event,handler:handler});};lib.setAndRegisterTimeout=function(fn,delay){var id;id=null;if(!lib.jsLocked()){id=setTimeout(executeIfNotLocked(fn),delay);timers.push(id);}
return id;};lib.registerXhr=function(xhr){xhrs.push(xhr);};lib.submitLink=function(url){url=splitHref(url);url.params.oldpage=url.page;changePage(url.params);};lib.submitFunc=function(valFunc,applyNames){applyNames=applyNames||[];return function(evt){var valResult,form,action,data;form=jsl.eventTarget(evt,"form");valResult=true;if(valFunc&&(!clickedBtn.name||applyNames.indexOf(clickedBtn.name)>=0)){valResult=valFunc(evt,clickedBtn.name)!==false;}
if(valResult){action=splitHref(form.getAttribute("action"));if(action.page.indexOf("/cgi-bin/firmwarecfg")>=0){return true;}
if(clickedBtn.name){action.params[clickedBtn.name]=clickedBtn.value||"";}
action.params.oldpage=action.page;data=readForm(form,action.params);changePage(data);}
return jsl.cancelEvent(evt);};};lib.takeoverSubmit=function(form){var action,data;action=splitHref(form.getAttribute("action"));if(action.page.indexOf("/cgi-bin/firmwarecfg")>=0){return false;}
action.params.oldpage=action.page;data=readForm(form,action.params);changePage(data);return true;};lib.unload=function(target){removeHandlers();unloadScripts();unloadCss();jsl.setHtml(target,"");};lib.load=function(target,html){var content;target=jsl.get(target);if(!target){return;}
content=document.createElement("div");content.innerHTML=html;extractAndLoadScripts(content);extractAndLoadCss(content);target.appendChild(content);addFormHandler(content);addLinkHandler(content);};return lib;}());
var privateHistory;privateHistory=privateHistory||(function(){"use strict";var lib={},lMfHistory=[],lMfHistoryIdx=-1;function paramsAreNotIdenical(p1,p2){var i=0;if(p1.length===p2.length){for(i=0;i<p1.length;i+=1){if(p1[i]!==p2[i]){return true;}}
return false;}
return true;}
function restoreBrowserBackBtn(){if(window.onhashchange){window.onhashchange=null;history.back();}}
function removeLastHistoryEntry(){lMfHistory[lMfHistoryIdx].func=null;lMfHistory[lMfHistoryIdx].params=null;lMfHistory[lMfHistoryIdx]=null;lMfHistoryIdx-=1;if(0>lMfHistoryIdx){restoreBrowserBackBtn();}}
function revertPageToLastState(){var func=null,params=null;if(0<=lMfHistoryIdx&&lMfHistory[lMfHistoryIdx].func&&lMfHistory[lMfHistoryIdx].params){func=lMfHistory[lMfHistoryIdx].func;params=lMfHistory[lMfHistoryIdx].params;removeLastHistoryEntry();func.apply(null,params);}}
function preventBrowserBackBtn(){if(history.pushState){history.pushState(null,'','#');}else{location.hash='#';}
window.onhashchange=function(){if(""===location.hash){if(0>lMfHistoryIdx){history.back();}else{if(history.pushState){history.pushState(null,'','#');}else{location.hash='#';}
revertPageToLastState();}}};}
lib.getTopHistoryEntry=function(){if(0<=lMfHistoryIdx&&lMfHistory[lMfHistoryIdx].func&&lMfHistory[lMfHistoryIdx].params){return lMfHistory[lMfHistoryIdx];}
return null;};lib.addToHistory=function(func,params){var lastIdx=lMfHistoryIdx;lMfHistoryIdx+=1;if(!lMfHistory[lMfHistoryIdx]){lMfHistory[lMfHistoryIdx]={};}
if(lastIdx<0||func!==lMfHistory[lastIdx].func||paramsAreNotIdenical(params,lMfHistory[lastIdx].params)){lMfHistory[lMfHistoryIdx].func=func;lMfHistory[lMfHistoryIdx].params=params;if(lastIdx<0){preventBrowserBackBtn();}}};lib.removeLastFuncHistoryEntry=function(func){var i=0,j=0;for(i=lMfHistoryIdx;i>-1;i-=1){if(lMfHistory[i].func===func){for(j=i;j+1<=lMfHistoryIdx;j+=1){lMfHistory[j].func=lMfHistory[j+1].func;lMfHistory[j].params=lMfHistory[j+1].params;}
removeLastHistoryEntry();break;}}};lib.removeAllOfType=function(func){var newHistory=[],i=0;for(i=0;i<lMfHistoryIdx;i+=1){if(lMfHistory[i].func!==func){newHistory[newHistory.length]=lMfHistory[i];}}
lMfHistory=newHistory;lMfHistoryIdx=lMfHistory.length-1;};return lib;}());
var config,require,jsl,http,html,html2,oldPage,privateHistory,browser,wizard,main;main=main||(function(){"use strict";var lib={},gPageTimer={time:0,displayInterval:null,txtElem:null},gNavMenu=null,gAvmLogo=null,gUserLogo=null,gUserMenuBox=null,gUserMenu=null,gBlueBarBox=null,gBlueBarRightBox=null,gBlueBarTitle=null,gMainBox=null,gDisablePage=null,gTabMenu=null,gBtnMenu=null,gBreadCrump=null,gFallback=null,gHelpWin=null,gHelpBtnBox=null,gUsePwd=false,gBoxType="",gBoxName="",gCheckedTabRoots={},gHead=null,gRefreshTimers=null,gRemPxDiv=null,gXhrTab={},gUsername="",gLastPids=[],gRefreshParams=null,gBodyTag=document.body,gHtmlTag=document.documentElement,gExpertTxt={"true":"Ansicht: Erweitert","false":"Ansicht: Standard"};lib.sid="";lib.fromInternet=false;lib.lang="";lib.manUrl="";lib.serviceUrl="";lib.newsUrl="";lib.avmUrl="";lib.menuBox=null;lib.contentBox=null;lib.cache={};lib.jsObjPrefix="JsObj";lib.timestamps={};lib.pages={};lib.menu={};lib.aktPid="";lib.pidParams=null;lib.oauthCode=null;lib.oauthError=null;lib.dbgCache=null;lib.registerPageJs=function(factory){var name=lib.aktPid+lib.jsObjPrefix;window[name]=window[name]||factory();};function stopAllXhr(){if(gXhrTab){Object.keys(gXhrTab).forEach(function(xhrId){if(gXhrTab[xhrId].stop){gXhrTab[xhrId].stop();}else{Object.keys(gXhrTab[xhrId]).forEach(function(timerId){gXhrTab[xhrId][timerId].stop();lib.delRefreshTimer(timerId);});}});}else{gXhrTab={};}}
function stopXhr(pid_xhrId,timerId){if(pid_xhrId&&timerId){if(gXhrTab&&gXhrTab[pid_xhrId]&&gXhrTab[pid_xhrId][timerId]&&gXhrTab[pid_xhrId][timerId].stop){gXhrTab[pid_xhrId][timerId].stop();}}else if(!pid_xhrId&&timerId){if(gRefreshTimers&&gRefreshTimers[timerId]&&gRefreshTimers[timerId].pid){stopXhr(gRefreshTimers[timerId].pid,timerId);}}else if(pid_xhrId&&!timerId){if(gXhrTab&&gXhrTab[pid_xhrId]&&gXhrTab[pid_xhrId].stop){gXhrTab[pid_xhrId].stop();}}}
lib.pauseRefreshTimer=function(timerId){if(gRefreshTimers){stopXhr(timerId);if(gRefreshTimers[timerId]&&gRefreshTimers[timerId].obj){window.clearTimeout(gRefreshTimers[timerId].obj);gRefreshTimers[timerId].obj=null;}}};lib.pauseRefreshTimers=function(){if(gRefreshTimers){Object.keys(gRefreshTimers).forEach(function(timerId){lib.pauseRefreshTimer(timerId);});}};lib.restartRefreshTimer=function(timerId,firstStart){if(gRefreshTimers&&gRefreshTimers[timerId]){if(!gRefreshTimers[timerId].paintFunc||!gRefreshTimers[timerId].pid||(gRefreshTimers[timerId].pid!==lib.aktPid)){lib.delRefreshTimer(timerId);return;}
lib.pauseRefreshTimer(timerId);if(firstStart){if(gRefreshTimers[timerId].initTime&&0<gRefreshTimers[timerId].initTime){gRefreshTimers[timerId].obj=window.setTimeout(function(){lib.getData(gRefreshTimers[timerId].pid,timerId,gRefreshTimers[timerId].paintFunc,gRefreshTimers[timerId].params);},gRefreshTimers[timerId].initTime);}else if(!gRefreshTimers[timerId].initTime){lib.getData(gRefreshTimers[timerId].pid,timerId,gRefreshTimers[timerId].paintFunc,gRefreshTimers[timerId].params);}}else if(gRefreshTimers[timerId].refTime&&0<gRefreshTimers[timerId].refTime){gRefreshTimers[timerId].obj=window.setTimeout(function(){lib.getData(gRefreshTimers[timerId].pid,timerId,gRefreshTimers[timerId].paintFunc,gRefreshTimers[timerId].params);},gRefreshTimers[timerId].refTime);}else if(!gRefreshTimers[timerId].refTime){lib.getData(gRefreshTimers[timerId].pid,timerId,gRefreshTimers[timerId].paintFunc,gRefreshTimers[timerId].params);}}};lib.restartRefreshTimers=function(firstStart){if(gRefreshTimers){Object.keys(gRefreshTimers).forEach(function(timerId){lib.restartRefreshTimer(timerId,firstStart);});}};lib.setRefreshTimers=function(timers){if(!gRefreshTimers){gRefreshTimers={};}
Object.keys(timers).forEach(function(timerId){if(!timers[timerId].paintFunc||!timers[timerId].pid||(timers[timerId].pid!==lib.aktPid)){timers[timerId]=null;}else{lib.delRefreshTimer(timerId);gRefreshTimers[timerId]=timers[timerId];lib.restartRefreshTimer(timerId,true);}});};lib.delRefreshTimer=function(timerId){if(gRefreshTimers&&gRefreshTimers[timerId]){lib.pauseRefreshTimer(timerId);gRefreshTimers[timerId]=null;return true;}
return false;};lib.delRefreshTimers=function(){if(gRefreshTimers){lib.pauseRefreshTimers();Object.keys(gRefreshTimers).forEach(function(timerId){gRefreshTimers[timerId]=null;});}
gRefreshTimers=null;};lib.getRefreshTimer=function(timerId){return gRefreshTimers[timerId];};lib.getRefreshTimers=function(){return gRefreshTimers;};function getPidByPage(page){var pagePid=null;if(lib.pages[page]){return page;}
Object.keys(lib.pages).some(function(pid){if(lib.pages[pid].lua&&page==="/"+lib.pages[pid].lua){pagePid=pid;return true;}});return pagePid;}
function delTabs(){var tabs2remove=null;jsl.removeClass(gBodyTag,"mainTab");jsl.removeClass(gTabMenu,"show");tabs2remove=jsl.getByClass("show",gTabMenu);Object.keys(tabs2remove).forEach(function(tabPid){jsl.removeClass(tabs2remove[tabPid],"show");jsl.get(tabs2remove[tabPid]).setAttribute("aria-hidden","true");jsl.removeClass(tabs2remove[tabPid],"selected");});}
function delMenu(pid){var parent=null,item2remove=null;item2remove=jsl.getByClass("selected",gNavMenu);Object.keys(item2remove).forEach(function(itemPid){jsl.removeClass(item2remove[itemPid],"selected");});if(lib.menu[pid]&&lib.menu[pid].par){parent=lib.menu[pid].par;while(parent){if(lib.menu[parent].tab){delTabs();}
parent=lib.menu[parent].par;}
parent=null;}
jsl.removeClass(gBtnMenu,"show");jsl.removeClass(gBodyTag,"mainBtn");jsl.removeClass(gBodyTag,"hideMenu");jsl.removeClass(gHelpBtnBox,"hide");}
lib.smoothScrollTo=function(scrollObj,x,y,useXyAsScrollBy,scrollDuration){var scrollX,scrollY,stepTime=15,steps=Math.ceil((scrollDuration||400)/stepTime),scrollCnt=0,signX,signY,scrollMarginX,scrollMarginY;function doScrollStep(){if((scrollX||scrollY)&&scrollCnt<steps){setTimeout(function(){window.requestAnimationFrame(doScrollStep);scrollCnt=scrollCnt+1;if(scrollX){if(scrollCnt*scrollMarginX>scrollX){scrollMarginX=(scrollCnt*scrollMarginX)-scrollX;scrollX=0;}
scrollObj.scrollLeft+=scrollMarginX*signX;}
if(scrollY){if(scrollCnt*scrollMarginY>scrollY){scrollMarginY=(scrollCnt*scrollMarginY)-scrollY;scrollY=0;}
scrollObj.scrollTop+=scrollMarginY*signY;}},stepTime);}}
if(scrollObj){scrollX=x?useXyAsScrollBy?x:x-scrollObj.scrollLeft:0;scrollY=y?useXyAsScrollBy?y:y-scrollObj.scrollTop:0;signX=(0>scrollX)?-1:1;signY=(0>scrollY)?-1:1;scrollX*=signX;scrollY*=signY;scrollMarginX=Math.ceil(scrollX/steps);scrollMarginY=Math.ceil(scrollY/steps);window.requestAnimationFrame(doScrollStep);}};function onScrollBottom(){var openItems;openItems=jsl.getByClass("open",gNavMenu);if(openItems&&openItems[0]&&openItems[0].id==="sys"){lib.smoothScrollTo(gNavMenu,0,gNavMenu.scrollHeight-gNavMenu.offsetHeight);}}
function handleSubmenu(pid){var openItems=jsl.getByClass("open",gNavMenu),closedItemId=false,subMenuItem=null,menuItem=null;Object.keys(openItems).forEach(function(openItemId){jsl.removeClass(openItems[openItemId],"open");if(jsl.hasClass("submenu")){openItems[openItemId].setAttribute("aria-hidden","true");}
if(openItems[openItemId].id&&pid===openItems[openItemId].id){closedItemId=true;}});menuItem=jsl.get(pid);subMenuItem=jsl.get(pid+"sub");if(menuItem&&subMenuItem&&!closedItemId){jsl.addClass(menuItem,"open");jsl.addClass(subMenuItem,"open");window.setTimeout(onScrollBottom,400);subMenuItem.setAttribute("aria-hidden","false");}}
function pidExistsAndShown(pid){if(!pid){return null;}
if(lib.menu[pid]&&lib.menu[pid].tab){lib.menu[pid].tab.some(function(tabPid){pid=pidExistsAndShown(tabPid);return pid;});}else if(lib.menu[pid]&&lib.menu[pid].sub){lib.menu[pid].sub.some(function(subPid){pid=pidExistsAndShown(subPid);return pid;});}
if(lib.pages[pid]&&lib.pages[pid].show){return pid;}
return null;}
function showTab(tabPid){if(pidExistsAndShown(tabPid)){jsl.addClass(tabPid,"show");jsl.get(tabPid).setAttribute("aria-hidden","false");}}
lib.scrollSelectedTabIntoView=function(scrollElemParent){var selectedTab;scrollElemParent=scrollElemParent||gTabMenu;selectedTab=jsl.getByClass("selected",scrollElemParent)[0]||jsl.getByClass("active",scrollElemParent)[0];if(selectedTab){if(selectedTab.offsetLeft<(scrollElemParent.children[0].scrollLeft+scrollElemParent.children[1].offsetWidth)||((selectedTab.offsetLeft+selectedTab.offsetWidth)-scrollElemParent.children[0].scrollLeft>(scrollElemParent.children[0].offsetWidth-scrollElemParent.children[2].offsetWidth+scrollElemParent.children[0].offsetLeft+1))){lib.smoothScrollTo(scrollElemParent.children[0],(selectedTab.offsetLeft+(selectedTab.offsetWidth/2))-((scrollElemParent.children[0].offsetWidth+scrollElemParent.children[0].offsetLeft+1)/2),0);}}};function setMenu(pid){var parent=null,openItems=null,tabs2remove=null;if((pid&&lib.pages[pid]&&(lib.pages[pid].wiz||lib.pages[pid].dev))||jsl.get("oldPageIsWiz")){jsl.addClass(gBodyTag,"hideMenu");if(!lib.pages[pid].help){jsl.addClass(gHelpBtnBox,"hide");}
return;}
if(lib.menu[pid]){jsl.addClass(pid,"selected");if(lib.menu[pid].par){parent=lib.menu[pid].par;while(parent&&lib.menu[parent]){jsl.addClass(parent,"selected");if(lib.menu[parent].sub&&!jsl.hasClass(parent,"open")){handleSubmenu(parent);}
if(lib.menu[parent].tab&&gTabMenu){lib.menu[parent].tab.forEach(showTab);tabs2remove=jsl.getByClass("show",gTabMenu);if(tabs2remove&&1<tabs2remove.length){jsl.addClass(gTabMenu,"show");jsl.addClass(gBodyTag,"mainTab");}}
parent=lib.menu[parent].par;}}else{openItems=jsl.getByClass("open",gNavMenu);Object.keys(openItems).forEach(function(openItemId){jsl.removeClass(openItems[openItemId],"open");if(jsl.hasClass("submenu")){openItems[openItemId].setAttribute("aria-hidden","true");}});}}}
function showSelectedMenu(refreshOnly){var openItems=jsl.getByClass("open",gNavMenu),selectedItems=jsl.getByClass("selected",gNavMenu);Object.keys(openItems).forEach(function(idx){jsl.removeClass(openItems[idx],"open");if(jsl.hasClass("submenu")){openItems[idx].setAttribute("aria-hidden","true");}});if(1<selectedItems.length){jsl.addClass(selectedItems[1],"open");if(lib.menu[selectedItems[1].id].par){jsl.addClass(lib.menu[selectedItems[1].id].par,"open");jsl.addClass(lib.menu[selectedItems[1].id].par+"sub","open");jsl.get(lib.menu[selectedItems[1].id].par+"sub").setAttribute("aria-hidden","false");}}
if(!refreshOnly&&!jsl.hasClass(lib.menuBox,"show")){jsl.addClass(lib.menuBox,"show");jsl.addClass(gDisablePage,"activ");jsl.addClass(gHelpBtnBox,"show");}}
function createBreadcrumpPart(pageElem,before){var div=document.createElement("div");div.setAttribute("class","arrow_box");jsl.setText(div,pageElem.txt);if(before){gBreadCrump.children[0].insertBefore(div,before);}else{gBreadCrump.children[0].appendChild(div);}
div.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);showSelectedMenu();},false);return div;}
function setBreadcrump(pid,titleStr){var pageElem=null,before=null;gBreadCrump.innerHTML="<div id='uiPageTitle'></div>";jsl.removeClass(gBreadCrump,"manuTitle");if("overview"===pid){jsl.addClass(gBreadCrump,"hide");jsl.removeClass(gBlueBarTitle,"hide");}else{jsl.removeClass(gBreadCrump,"hide");jsl.addClass(gBlueBarTitle,"hide");}
if(titleStr){createBreadcrumpPart({txt:titleStr},null);}else if(lib.menu[pid]){pageElem=lib.menu[pid];if(!pageElem.par){createBreadcrumpPart(pageElem);}else{if(pageElem.par&&lib.menu[pageElem.par]&&!lib.menu[pageElem.par].tab){before=createBreadcrumpPart(pageElem);}
while(pageElem.par&&lib.menu[pageElem.par]){pageElem=lib.menu[pageElem.par];before=createBreadcrumpPart(pageElem,before);}}}else if(lib.pages[pid]){if(lib.pages[pid].txt){createBreadcrumpPart(lib.pages[pid],null);}}
if(gBreadCrump.children[0].offsetWidth&&gBreadCrump.children[0].scrollWidth&&gBreadCrump.children[0].offsetWidth<gBreadCrump.children[0].scrollWidth){gBreadCrump.children[0].scrollLeft=(gBreadCrump.children[0].scrollWidth-gBreadCrump.children[0].offsetWidth);}}
function refreshPagesData(hideDataTab){var changedPids={};Object.keys(lib.pages).forEach(function(pid){if(hideDataTab[pid]&&lib.pages[pid]&&lib.pages[pid].show){changedPids[pid]=true;lib.pages[pid].show=false;}else if(!hideDataTab[pid]&&lib.pages[pid]&&!lib.pages[pid].show){changedPids[pid]=true;lib.pages[pid].show=true;}});return changedPids;}
function toRootMenuItem(pid,tabRoot){if(lib.menu[pid]&&lib.menu[pid].par){if(!tabRoot||(tabRoot&&lib.menu[lib.menu[pid].par]&&lib.menu[lib.menu[pid].par].tab)){return toRootMenuItem(lib.menu[pid].par,tabRoot);}}
return pid;}
function checkTabRootForGpageAndShow(pid){if(lib.menu[pid]){if(lib.aktPid===pid&&lib.pages[pid]&&lib.pages[pid].show){return true;}
if(lib.menu[pid].tab){return lib.menu[pid].tab.some(function(tabPid){return checkTabRootForGpageAndShow(tabPid);});}}
return false;}
function isTabToShow(pid){var rootPid="";rootPid=toRootMenuItem(pid,true);if(!gCheckedTabRoots[rootPid]){gCheckedTabRoots[rootPid]=checkTabRootForGpageAndShow(rootPid);}
return gCheckedTabRoots[rootPid];}
function setMenuItemVisibility(pid,isTab){var visible=false,pidElem=null;if(!lib.menu[pid]){return visible;}
if(lib.menu[pid].sub){lib.menu[pid].sub.forEach(function(subPid){visible=setMenuItemVisibility(subPid)||visible;});}
if(lib.menu[pid].tab){lib.menu[pid].tab.forEach(function(tabPid){visible=setMenuItemVisibility(tabPid,true)||visible;});}
if(lib.pages[pid]){visible=lib.pages[pid]&&lib.pages[pid].show;}
if(lib.menu[pid].lnk&&false!==lib.menu[pid].show){visible=true;}
pidElem=jsl.get(pid);if(pidElem){if(visible&&(!isTab||(isTab&&lib.aktPid&&isTabToShow(pid)))){jsl.addClass(pidElem,"show");pidElem.setAttribute("aria-hidden","false");}else{jsl.removeClass(pidElem,"show");pidElem.setAttribute("aria-hidden","true");}}
return visible;}
function refreshMenu(hideData){var hideIds=hideData||null,pageIdsToMod={},fixedParents={},rootMenuItemId=null,activePagePid,oldPageMenuPid;if(!hideIds){hideIds=JSON.parse(jsl.getValue("fdhidedata")||"{}");activePagePid=getPidByPage(jsl.getValue("oldpageactive"));oldPageMenuPid=getPidByPage(jsl.getValue("oldpageMenu"));if(activePagePid){lib.aktPid=activePagePid;if(!oldPageMenuPid){oldPageMenuPid=lib.aktPid;}
delMenu();delTabs();setMenu(oldPageMenuPid);if(oldPageMenuPid!==lib.aktPid){delTabs();}
setBreadcrump(lib.aktPid,jsl.getValue("oldPageTitle"));}}
pageIdsToMod=("overview"===lib.aktPid)?{}:refreshPagesData(hideIds);gCheckedTabRoots={};Object.keys(lib.menu).forEach(function(idx){if(pageIdsToMod[idx]&&lib.pages[idx]){rootMenuItemId=toRootMenuItem(idx);if(lib.menu[rootMenuItemId]&&!fixedParents[rootMenuItemId]){setMenuItemVisibility(rootMenuItemId);fixedParents[rootMenuItemId]=true;}}});}
function getFootBtnBox(){return jsl.get("btn_form_foot")||jsl.getByClass("btn_form_foot",lib.contentBox)[0];}
lib.footBtnSticky=function(){var tmp=(gMainBox&&gMainBox.getBoundingClientRect())||null;if(tmp){if(tmp.bottom>=window.innerHeight){jsl.addClass(gBodyTag,"stickyBottom");}else{jsl.removeClass(gBodyTag,"stickyBottom");}}};lib.checkForButtonsInFoot=function(){if(getFootBtnBox()){jsl.addClass(gBodyTag,"mainBtn");window.setTimeout(lib.footBtnSticky,200);}else{jsl.removeClass(gBodyTag,"mainBtn");}};function sendLink(href,target,filename){var a=html2.a({href:href,"class":"nocancel",target:target},""),clickEvt=null;html2.add(gBodyTag,a);if(!a.target){stopAllXhr();}
if(filename){a.download=filename;}
if(a.click){a.click();}else if(document.dispatchEvent){clickEvt=document.createEvent("MouseEvent");clickEvt.initEvent("click",true,true);a.dispatchEvent(clickEvt);}else if(document.fireEvent){a.fireEvent('onclick');}
gBodyTag.removeChild(a);}
function paintPage(resp,skipMenuRefresh){var dbgData,tt,tmpSid;jsl.log("paintPage",lib.aktPid);jsl.removeClass(gMainBox,"no_content");jsl.removeClass(gBodyTag,"cache");oldPage.load("content",resp);tmpSid=jsl.getValue("oldPageXhrSid");if(!tmpSid||tmpSid!==lib.sid){if(!lib.aktPid){lib.aktPid="";}
sendLink("?lp="+encodeURIComponent(lib.aktPid.toString()));}
if(lib.dbgCache){dbgData={};dbgData.content=resp;dbgData.date=new Date().toLocaleString();dbgData.dbg=JSON.parse(jsl.getValue("gDbgInfo")||"{}");if(!lib.dbgCache[lib.aktPid]){lib.dbgCache[lib.aktPid]=[];}
if(lib.dbgCache[lib.aktPid].length>10){lib.dbgCache[lib.aktPid].shift();}
lib.dbgCache[lib.aktPid].push(dbgData);}
jsl.log("SetTime when timestamp div exist");tt=jsl.getText("uiLuatime")+" / "+(new Date().getTime()-lib.timestamps[lib.aktPid])+" ms";jsl.setText("uiLuatime",tt);if(!skipMenuRefresh){refreshMenu();}
lib.checkForButtonsInFoot();}
function cbGetData(resp,callBack,timerId){var tt;if(resp&&"object"===typeof resp&&resp.sid&&resp.sid===lib.sid){if(!resp.err&&resp.pid&&resp.pid===lib.aktPid){if(resp.data&&callBack){lib.cache[lib.aktPid]=((lib.aktPid==="overview")&&{data:resp.data,callBack:callBack})||null;}
if(resp.hide){refreshMenu(resp.hide);}
if(resp.dbg){if(!lib.dbgCache[lib.aktPid]){lib.dbgCache[lib.aktPid]=[];}
if(lib.dbgCache[lib.aktPid].length>10){lib.dbgCache[lib.aktPid].shift();}
resp.date=new Date().toLocaleString();lib.dbgCache[lib.aktPid].push(resp);}
jsl.removeClass(gMainBox,"no_content");jsl.removeClass(gBodyTag,"cache");if(callBack&&resp.data){if(timerId&&gRefreshTimers&&gRefreshTimers[timerId]&&gRefreshTimers[timerId].refTime){lib.restartRefreshTimer(timerId);}
callBack(resp.data,timerId);jsl.log("create Timestamp div for new pages");if(resp.data.timestamp){tt=resp.data.timestamp+" ms / "+(new Date().getTime()-lib.timestamps[lib.aktPid])+" ms";}else{tt=(new Date().getTime()-lib.timestamps[lib.aktPid])+" ms";}
if("release"!==config.gu_type&&"labor"!==config.gu_type){if(jsl.get("uiLuatime")){jsl.setText("uiLuatime",tt);}else{html2.add(lib.contentBox,html2.div({id:"uiLuatime"},tt));}}
lib.checkForButtonsInFoot();}}else if(resp&&resp.err){if(resp.answer&&"string"===typeof resp.answer&&-1<resp.answer.search("oldpageactive")){paintPage(resp.answer);}else{lib.changePage(null,"overview");}}}else if(resp&&"object"===typeof resp&&(!resp.sid||resp.sid!==lib.sid)){if(!lib.aktPid){lib.aktPid="";}
sendLink("?lp="+encodeURIComponent(lib.aktPid.toString()));}}
lib.getData=function(pid,timerId,callBack,timerParams){var params;params={sid:lib.sid,lang:lib.lang,page:pid,xhrId:timerId};if(timerParams&&"object"===typeof timerParams){Object.keys(timerParams).forEach(function(key){if(!params[key]){params[key]=timerParams[key];}});}
stopXhr(pid,timerId);if(!gXhrTab[pid]){gXhrTab[pid]={};}
if(lib.dbgCache){params.dbg=1;}
lib.timestamps[lib.aktPid]=new Date().getTime();gXhrTab[pid][timerId]=http.request({method:"POST",url:"data.lua",params:params,callback:function(response){cbGetData(response,callBack,timerId);}});gXhrTab[pid][timerId].start();};function helpPopup(){var opts="",height=window.screen.availHeight,width=window.screen.availWidth,href="",helpPage=jsl.getValue("gHelpPage")||null;if(!lib.aktPid||!lib.pages||!lib.pages[lib.aktPid]||lib.pages[lib.aktPid].wiz){return;}
if(660<height){height=660;}
if(900<width){width=900;}
opts='width='+width+',height='+height+',resizable=yes,scrollbars=yes,toolbar=yes,location=yes';href=encodeURI('/help/help.lua')+'?'+encodeURIComponent("sid")+"="+encodeURIComponent(lib.sid)+'&'+encodeURIComponent("lang")+"="+encodeURIComponent(lib.lang);if(helpPage){href+='&'+encodeURIComponent("helppage")+"="+encodeURIComponent(helpPage);}else{href+='&'+encodeURIComponent("helppage")+"="+encodeURIComponent(lib.aktPid);}
if(!gHelpWin||gHelpWin.closed===undefined||gHelpWin.closed){gHelpWin=window.open(href,"HelpWindow",opts);}else{gHelpWin.location.href=href;}
if(gHelpWin&&gHelpWin.focus){gHelpWin.focus();}}
function setExpertMode(){var expertSwitch=jsl.get("expert"),timer=null;if(jsl.hasClass(expertSwitch,"disabled")){return;}
jsl.addClass(expertSwitch,"disabled");timer=window.setTimeout(function(){timer=null;jsl.removeClass(expertSwitch,"disabled");},10000);stopAllXhr();jsl.removeClass(expertSwitch,"off");jsl.setText("menuFooterViewLnk",gExpertTxt["true"]);if(true===lib.menu.expert.state){jsl.addClass(expertSwitch,"off");jsl.setText("menuFooterViewLnk",gExpertTxt["false"]);}
if(!gXhrTab.expert){gXhrTab.expert=http.request({method:"POST",url:"data.lua",params:{sid:lib.sid,page:"expert"},callback:function(resp){window.clearTimeout(timer);timer=null;if(resp.hide){refreshMenu(resp.hide);}
if(resp.data&&(true===resp.data.expertMode||false===resp.data.expertMode)){jsl.removeClass(expertSwitch,"off");if(false===resp.data.expertMode){jsl.addClass(expertSwitch,"off");}
lib.menu.expert.state=resp.data.expertMode;jsl.setText("menuFooterViewLnk",gExpertTxt[lib.menu.expert.state.toString()]);lib.changePage(null,lib.aktPid||"overview",true);}
jsl.removeClass(expertSwitch,"disabled");}});}
gXhrTab.expert.start();}
function doLogout(noLp){var xhr,scripts,lpParam="";lib.delRefreshTimers();if(gPageTimer.displayInterval){window.clearInterval(gPageTimer.displayInterval);}
stopAllXhr();if(!noLp){if(!lib.aktPid){lib.aktPid="";}
lpParam='?lp='+encodeURIComponent(lib.aktPid.toString());}
xhr=http.request({method:"POST",url:"index.lua",type:'text',params:{sid:lib.sid,logout:"1"},callback:function(){window.setTimeout(function(){var a=html2.a({href:"","class":"nocancel"},""),clickEvt=null;html2.add(gBodyTag,a);if(a.click){a.click();}else if(document.dispatchEvent){clickEvt=document.createEvent("MouseEvent");clickEvt.initEvent("click",true,true);a.dispatchEvent(clickEvt);}else if(document.fireEvent){a.fireEvent('onclick');}
document.body.removeChild(a);},800,lpParam);}});xhr.start();window.history.replaceState({},'','/');lib.cache=null;lib.dbgCache=null;lib.aktPid=null;lib.menu=null;lib.menuBox=null;gUserMenuBox=null;gBreadCrump=null;gBtnMenu=null;gTabMenu=null;gHelpBtnBox=null;gMainBox=null;lib.sid="";gBodyTag.innerHTML="";gBlueBarBox=document.createElement("header");gBlueBarBox.id="blueBarBox";gBlueBarBox.setAttribute("class","logout");html2.add(gBodyTag,gBlueBarBox);html2.add(gBlueBarBox,html2.div({class:"blueBarLogo logout"}),html2.div({id:"blueBarRightBox",class:"blueBarRightBox"},html2.div({class:"blue_bar_title"},gBoxType),html2.div({})));html2.add(gBodyTag,html2.div({id:"disablePage",class:"logout"},html2.a({href:lpParam}),html2.div({},"Erfolgreich abgemeldet")));scripts=document.getElementsByTagName("script");Object.keys(scripts).forEach(function(idx){if(scripts[idx].innerHTML){scripts[idx].innerHTML="";}});scripts=null;}
function handleLink(pid){var target="";if("expert"===pid){setExpertMode();return;}
if("box"===pid){lib.changePage(null,"overview");return;}
if("logout"===lib.menu[pid].lnk){doLogout(true);return;}
if("dbg"===lib.menu[pid].lnk){sendLink('data:text/json;charset=utf8,'+encodeURIComponent(JSON.stringify(lib.dbgCache,null,2)),"","dbg.txt");return;}
if("nas"===lib.menu[pid].lnk||"myfritz"===lib.menu[pid].lnk){sendLink("/"+lib.menu[pid].lnk+"/?"+encodeURIComponent("sid")+"="+encodeURIComponent(lib.sid));return;}
if(0===lib.menu[pid].lnk.indexOf('http:')||0===lib.menu[pid].lnk.indexOf('https:')){target="_blank";}
sendLink(lib.menu[pid].lnk,target);}
function loadOldpage(pid,addParams){jsl.log("loadOldpage",pid,addParams);var params={sid:lib.sid,lang:lib.lang};function cbLoad(answer){var tabAnswer;if(!answer){if(!lib.aktPid){lib.aktPid="";}
(jsl.keypath("oldPage.stop",gXhrTab)||func.noop)();jsl.log("cbLoad no answer",stop);return loadOldpage(pid,addParams);}
try{tabAnswer=JSON.parse(answer);}catch(evt){paintPage(answer);return evt;}
if(tabAnswer&&tabAnswer.pid&&lib.pages[tabAnswer.pid]&&lib.pages[tabAnswer.pid].js){lib.changePage(null,tabAnswer.pid);}else if(tabAnswer&&tabAnswer.pid&&"logout"===tabAnswer.pid){doLogout();}else{paintPage(answer);}}
pid=pid||lib.aktPid;addParams=addParams||{};if(!addParams.oldpage&&!pid){jsl.log("loadOldpage: no pid or oldpage");return;}
if(lib.oauthCode){params.code=lib.oauthCode;}
if(lib.oauthError){params.error=lib.oauthError;}
jsl.log("save timestamp startpoint ");lib.timestamps[pid]=new Date().getTime();if(!gXhrTab.oldPage){gXhrTab.oldPage=http.request({method:"POST",url:"data.lua",type:'text',params:params,callback:cbLoad});}
jsl.setHtml(lib.contentBox,"");if(lib.cache[pid]&&lib.cache[pid].data&&lib.cache[pid].callBack){if(paintPage===lib.cache[pid].callBack){lib.cache[pid].callBack(lib.cache[pid].data,true);}else{lib.cache[pid].callBack(lib.cache[pid].data);}}else{jsl.addClass(gMainBox,"no_content");}
if(!addParams.oldpage){addParams.page=pid;}
if(lib.dbgCache){addParams.dbg=1;}
gXhrTab.oldPage.start(addParams);}
function changeBlueBarHeadline(evt){if(gBoxName&&0<gBoxName.length){jsl.addClass(evt.target,"fade");window.setTimeout(function(){if(jsl.hasClass(evt.target,"userName")){jsl.setText(evt.target,gBoxType);jsl.removeClass(evt.target,"userName");}else{jsl.setText(evt.target,gBoxName);jsl.addClass(evt.target,"userName");}
jsl.removeClass(evt.target,"fade");},175);}}
function setStyleFlexOrder(elem,order){if("object"===typeof elem&&null!==order){order=order.toString();elem.style['-webkit-box-ordinal-group']=order;elem.style['-moz-box-ordinal-group']=order;elem.style['-ms-flex-order']=order;elem.style['-webkit-order']=order;elem.style.order=order;}}
function createTab(pid,subLevel){var link=null;if(!lib.menu[pid]){return;}
subLevel=(null===subLevel)?0:subLevel;if(lib.menu[pid].tab){lib.menu[pid].tab.forEach(function(pageId){createTab(pageId,subLevel+1);});}
link=html2.a({href:"/?sid="+lib.sid+"&lp="+pid,id:pid,"class":(lib.menu[pid].tabClass||"")+" tab"},lib.menu[pid].txt);html2.add(gTabMenu.children[0],link);link.setAttribute("role","menuitem");link.setAttribute("aria-hidden","true");setStyleFlexOrder(link,lib.menu[pid].pos);link.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.changePage(evt);lib.scrollSelectedTabIntoView();return false;},false);return;}
function createMenuItem(pObj){var pos=null,link=null,tmp=null,menu=null,subDiv=null,expertMode="",iconClass="",menuArray=[];if(lib.menu&&lib.menu[pObj.pid]&&(false!==lib.menu[pObj.pid].show)){pos=(0>lib.menu[pObj.pid].pos)?-1*lib.menu[pObj.pid].pos:lib.menu[pObj.pid].pos;if(!pObj.father||"object"!==typeof pObj.father){iconClass=" icon_"+pObj.pid;if(false===lib.menu[pObj.pid].state){expertMode=" off";}
menu=gNavMenu;if(0>lib.menu[pObj.pid].pos){menu=gUserMenu;}
if(999<pos){pObj.father=jsl.getByClass("foot",menu)[0];}else{pObj.father=jsl.getByClass("head",menu)[0];}}
if(!pObj.father||"object"!==typeof pObj.father){window.alert("ERROR Menü kann nicht gezeichnet werden.");return;}
if(lib.menu[pObj.pid].lnk){if(("nas"===pObj.pid&&lib.menu[pObj.pid].show)||"myfritz"===pObj.pid){link=html2.a({href:"/"+lib.menu[pObj.pid].lnk+"?sid="+lib.sid,id:pObj.pid,"class":"nocancel"},lib.menu[pObj.pid].txt);html2.add(pObj.father,link);tmp=html2.a({href:"/"+lib.menu[pObj.pid].lnk+"?sid="+lib.sid,"class":pObj.pid+" blueBarLnk nocancel"},lib.menu[pObj.pid].txt);html2.add(gBlueBarRightBox,tmp);tmp.setAttribute("role","link");tmp.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.changePage(null,pObj.pid);return false;},false);setStyleFlexOrder(tmp,pos);}else if("liveTv"===pObj.pid){link=html2.a({href:lib.menu[pObj.pid].lnk,id:pObj.pid,"class":"nocancel"},lib.menu[pObj.pid].txt);html2.add(pObj.father,link);tmp=html2.a({href:lib.menu[pObj.pid].lnk,"class":pObj.pid+" blueBarLnk nocancel"},lib.menu[pObj.pid].txt);html2.add(gBlueBarRightBox,tmp);tmp.setAttribute("role","link");tmp.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.changePage(null,pObj.pid);return false;},false);setStyleFlexOrder(tmp,pos);}else{tmp="";if("logout"===pObj.pid){tmp="nocancel";gPageTimer.txtElem=html2.span({id:pObj.pid+"_timer","class":"timer"});gPageTimer.txtElem.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.resetPageTimer();return false;},false);}
link=html2.a({href:lib.menu[pObj.pid].lnk,id:pObj.pid,"class":tmp},("logout"===pObj.pid&&gPageTimer.txtElem)||"",lib.menu[pObj.pid].txt);html2.add(pObj.father,link);}}else{link=html2.a({href:"/?sid="+lib.sid+"&lp="+pObj.pid,id:pObj.pid},lib.menu[pObj.pid].txt);html2.add(pObj.father,link);}
setStyleFlexOrder(link,pos);link.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.changePage(evt);return false;},false);if(lib.menu[pObj.pid].sub){jsl.addClass(link,"show menu_item with_sub"+iconClass+expertMode);link.setAttribute("role","menuitem");link.setAttribute("aria-haspopup","true");subDiv=html2.div({id:pObj.pid+"sub","class":"submenu"});html2.add(pObj.father,subDiv);subDiv.setAttribute("aria-live","polite");subDiv.setAttribute("aria-hidden","true");subDiv.setAttribute("aria-labelledby",link.id);setStyleFlexOrder(subDiv,pos+1);lib.menu[pObj.pid].sub.forEach(function(pid){if(pid&&lib.menu[pid]){menuArray.push(lib.menu[pid]);menuArray[menuArray.length-1].pid=pid;}});menuArray.sort(function(first,second){if(first.pos>second.pos){return 1;}
if(first.pos<second.pos){return-1;}
return 0;});menuArray.forEach(function(elem){createMenuItem({pid:elem.pid,father:subDiv});});}else if(lib.menu[pObj.pid].tab){jsl.addClass(link,"menu_item"+iconClass+expertMode);link.setAttribute("role","link");lib.menu[pObj.pid].tab.forEach(function(pid){createTab(pid);});}else{jsl.addClass(link,"menu_item"+iconClass+expertMode);link.setAttribute("role","link");}}}
lib.refreshUserMenu=function(){var lnk=jsl.getByClass("blueBarLnk",gBlueBarRightBox),menuArray=[];Object.keys(lnk).forEach(function(idx){gBlueBarRightBox.removeChild(lnk[idx]);});gUserMenu.innerHTML="<div class='menue head' role='menu'></div><div class='menue foot' role='menu'></div>";Object.keys(lib.menu).forEach(function(pid){if(lib.menu[pid]&&lib.menu[pid].pos&&0>lib.menu[pid].pos){menuArray.push(lib.menu[pid]);menuArray[menuArray.length-1].pid=pid;}});menuArray.sort(function(first,second){if(first.pos>second.pos){return 1;}
if(first.pos<second.pos){return-1;}
return 0;});menuArray.forEach(function(elem){createMenuItem({pid:elem.pid});setMenuItemVisibility(elem.pid);});};lib.refreshUserName=function(authMode){var userMenu=[],showUsername="user"===authMode||lib.fromInternet;userMenu=jsl.get("blueBarUserMenuIcon");if(userMenu){jsl.setText(userMenu,(showUsername&&gUsername)||"");if(showUsername&&gUsername&&""!==gUsername){jsl.addClass(userMenu,"showName");}else{jsl.removeClass(userMenu,"showName");}}
if(gUserLogo){jsl.setText(gUserLogo,(showUsername&&gUsername)||"");}};function blueBarMainMenuClick(evt){if(!evt){jsl.removeClass(lib.menuBox,"show");jsl.removeClass(gDisablePage,"activ");jsl.removeClass(gHelpBtnBox,"show");lib.menuBox.setAttribute("aria-hidden","true");gUserMenuBox.setAttribute("aria-hidden","false");gBlueBarBox.setAttribute("aria-hidden","false");gMainBox.setAttribute("aria-hidden","false");gHelpBtnBox.setAttribute("aria-hidden","false");gBreadCrump.setAttribute("aria-hidden","false");}else{showSelectedMenu();lib.menuBox.setAttribute("aria-hidden","false");gUserMenuBox.setAttribute("aria-hidden","true");gBlueBarBox.setAttribute("aria-hidden","true");gMainBox.setAttribute("aria-hidden","true");gHelpBtnBox.setAttribute("aria-hidden","true");gBreadCrump.setAttribute("aria-hidden","true");}
if(window.matchMedia("(min-width:1024px)").matches){if(lib.pages[lib.aktPid].wiz&&"function"===typeof wizard.cancel){wizard.cancel();}else{lib.changePage(null,"overview");}}}
function blueBarUserMenuClick(evt){jsl.removeClass(lib.menuBox,"show");if(!evt||jsl.hasClass(gUserMenuBox,"show")){jsl.removeClass(gUserMenuBox,"show");jsl.removeClass(gDisablePage,"activ");jsl.removeClass(gDisablePage,"userMenu");jsl.removeClass(gHelpBtnBox,"show");gUserMenuBox.setAttribute("aria-hidden","true");jsl.get("blueBarUserMenuIcon").setAttribute("aria-expanded","false");gBlueBarBox.setAttribute("aria-hidden","false");lib.menuBox.setAttribute("aria-hidden","false");gMainBox.setAttribute("aria-hidden","false");gHelpBtnBox.setAttribute("aria-hidden","false");gBreadCrump.setAttribute("aria-hidden","false");}else{jsl.addClass(gUserMenuBox,"show");jsl.addClass(gDisablePage,"activ");jsl.addClass(gDisablePage,"userMenu");jsl.addClass(gHelpBtnBox,"show");gUserMenuBox.setAttribute("aria-hidden","false");jsl.get("blueBarUserMenuIcon").setAttribute("aria-expanded","true");gBlueBarBox.setAttribute("aria-hidden","true");lib.menuBox.setAttribute("aria-hidden","true");gMainBox.setAttribute("aria-hidden","true");gHelpBtnBox.setAttribute("aria-hidden","true");gBreadCrump.setAttribute("aria-hidden","true");}}
function closeAllMenu(){if(jsl.hasClass(lib.menuBox,"show")){blueBarMainMenuClick();}else if(jsl.hasClass(gUserMenuBox,"show")){blueBarUserMenuClick();}}
function getSmallestPos(posObj){var tmp=null;posObj.forEach(function(pid){if(!lib.pages[pid]||!lib.pages[pid].show){return;}
if(tmp&&lib.menu[pid]&&lib.menu[pid].pos){tmp=(lib.menu[pid].pos<lib.menu[tmp].pos)?pid:tmp;}else if(lib.menu[pid]&&lib.menu[pid].pos){tmp=pid;}});return tmp;}
function getVisiblePageId(pid,firstPid){var tmpPid=pid;pid=pidExistsAndShown(pid);if(!pid){if(lib.menu[tmpPid]&&lib.menu[tmpPid].par&&lib.menu[lib.menu[tmpPid].par]){pid=getVisiblePageId(lib.menu[tmpPid].par,firstPid||tmpPid);}else if(tmpPid!==lib.aktPid){pid=getVisiblePageId(lib.aktPid,firstPid||tmpPid);}else{pid=getVisiblePageId("overview",firstPid||tmpPid);}}else{if(!firstPid||(firstPid&&lib.menu[firstPid]&&(lib.menu[firstPid].sub||lib.menu[firstPid].tab))){pid=tmpPid;}}
return pid;}
function getOldPagePid(params){function cancelPressed(params){return params.btn_cancel===""||params.btn_chancel===""||params.cancel==="";}
var oldPagePid=getPidByPage(params.oldpage),backToPagePid=getPidByPage(params.back_to_page);if(oldPagePid&&(!backToPagePid||(backToPagePid&&(oldPagePid!==lib.aktPid||!cancelPressed(params))))){return oldPagePid;}
if(backToPagePid&&backToPagePid!==lib.aktPid){return backToPagePid;}
return null;}
lib.createTabScrollArrows=function(scrollElemParent,needExtraIntoViewEvent){var childIdx=0;if(scrollElemParent){while(scrollElemParent.children[childIdx]){if((scrollElemParent.children[childIdx].tagName&&"DIV"===scrollElemParent.children[childIdx].tagName)||(scrollElemParent.children[childIdx].nodeName&&"DIV"===scrollElemParent.children[childIdx].nodeName)||(scrollElemParent.children[childIdx].localName&&"div"===scrollElemParent.children[childIdx].localName)){scrollElemParent.removeChild(scrollElemParent.children[childIdx]);childIdx-=1;}
childIdx+=1;}
if(scrollElemParent.children[0]&&!scrollElemParent.children[1]){scrollElemParent.appendChild(document.createElement("div"));scrollElemParent.children[1].addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.smoothScrollTo(scrollElemParent.children[0],-220,0,true);},false);scrollElemParent.appendChild(document.createElement("div"));scrollElemParent.children[2].addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.smoothScrollTo(scrollElemParent.children[0],220,0,true);},false);scrollElemParent.addEventListener("scroll",function(){window.requestAnimationFrame(function(){lib.showTabScroll(scrollElemParent.children[0].offsetWidth<scrollElemParent.children[0].scrollWidth,scrollElemParent);});},false);scrollElemParent.children[0].addEventListener("scroll",function(){window.requestAnimationFrame(function(){lib.showTabScroll(scrollElemParent.children[0].offsetWidth<scrollElemParent.children[0].scrollWidth,scrollElemParent);});},false);window.addEventListener("resize",function(){window.requestAnimationFrame(function(){if(scrollElemParent&&scrollElemParent.children[0]){lib.showTabScroll(scrollElemParent.children[0].offsetWidth<scrollElemParent.children[0].scrollWidth,scrollElemParent);}});},false);if(needExtraIntoViewEvent){scrollElemParent.addEventListener("click",function(evt){if(evt&&evt.stopPropagation){evt.stopPropagation();}
window.setTimeout(function(){lib.scrollSelectedTabIntoView(scrollElemParent);},200);},false);}
lib.showTabScroll(scrollElemParent.children[0].offsetWidth<scrollElemParent.children[0].scrollWidth,scrollElemParent);}}};lib.showTabScroll=function(show,scrollElemParent){scrollElemParent=scrollElemParent||gTabMenu;if(show){jsl.addClass(scrollElemParent,"tabScroll");if(0===scrollElemParent.children[0].scrollLeft){jsl.addClass(scrollElemParent.children[1],"hide");}else{jsl.removeClass(scrollElemParent.children[1],"hide");}
if(scrollElemParent.children[0].offsetWidth>=(scrollElemParent.children[0].scrollWidth-(scrollElemParent.children[0].scrollLeft+2))){jsl.addClass(scrollElemParent.children[2],"hide");}else{jsl.removeClass(scrollElemParent.children[2],"hide");}}else if(jsl.hasClass(scrollElemParent,"tabScroll")){jsl.removeClass(scrollElemParent,"tabScroll");jsl.removeClass(scrollElemParent.children[1],"hide");jsl.removeClass(scrollElemParent.children[2],"hide");}};lib.delContent=function(pid){var tt;pid=pid||lib.aktPid;if(lib.cache[pid]&&lib.cache[pid].data&&lib.cache[pid].callBack){jsl.removeClass(gMainBox,"no_content");jsl.addClass(gBodyTag,"cache");lib.cache[pid].callBack(lib.cache[pid].data);jsl.log("new data add timestamp");if(lib.cache[pid]){tt="1 ms / "+(new Date().getTime()-lib.timestamps[lib.aktPid])+" ms";}else{tt=(new Date().getTime()-lib.timestamps[lib.aktPid])+" ms";}
if("release"!==config.gu_type&&"labor"!==config.gu_type){if((!config.RELEASE||config.BETA_RELEASE)&&jsl.get("uiLuatime")){jsl.setText("uiLuatime",tt);}else{html2.add(lib.contentBox,html2.div({id:"uiLuatime"},tt));}}}else{lib.contentBox.innerHTML="";jsl.addClass(gMainBox,"no_content");}};lib.changePage=function(evt,pid,noHistory,addParams){var tmp=null,jsPid=null,lang=null,tmpDelMenuPid=null;lib.resetPageTimer();if(jsl.hasClass(gHtmlTag,"print")){return;}
jsl.removeClass(gBodyTag,"internalTab");if((evt&&evt.target&&evt.target.id)||pid||(addParams&&addParams.oldpage)){pid=pid||(evt&&evt.target&&evt.target.id);if(addParams&&!pid){pid=getOldPagePid(addParams);}
if(lib.menu[pid]&&"string"===typeof lib.menu[pid].lnk){handleLink(pid);return;}
if(!addParams){pid=getVisiblePageId(pid);}
if(!pid&&!addParams){return;}
if(pid&&lib.menu[pid]&&lib.menu[pid].sub){if(lib.menu[pid].sub){handleSubmenu(pid);return;}
if(lib.menu[pid].par&&!jsl.hasClass(lib.menu[pid].par,"open")){handleSubmenu(lib.menu[pid].par);return;}}
if(pid){jsl.log("Get new timeStamp für pid=",pid);lib.timestamps[pid]=new Date().getTime();}
stopAllXhr();if(true!==noHistory&&(lib.aktPid!==pid||(lib.aktPid===pid&&addParams&&(addParams.edit||(gRefreshParams&&(gRefreshParams.oldpage===addParams.backToPage||gRefreshParams.oldpage===addParams.back_to_page)))))){tmp=addParams?JSON.parse(JSON.stringify(addParams)):null;if((lib.aktPid===pid&&tmp&&tmp.edit)||(tmp&&gRefreshParams&&(gRefreshParams.oldpage===addParams.backToPage||gRefreshParams.oldpage===addParams.back_to_page))){tmp=gRefreshParams;}else if(!gRefreshParams&&pid&&lib.aktPid&&lib.aktPid!==pid){tmp=null;}
privateHistory.addToHistory(lib.changePage,[null,lib.aktPid||pid,true,tmp||null]);tmp=null;}
if(1>gLastPids.length||(0<gLastPids.length&&gLastPids[gLastPids.length-1]!==pid)){gLastPids.push(pid);}
if(lib.aktPid&&lib.pages[lib.aktPid]&&lib.pages[lib.aktPid].js){if(window[lib.aktPid+lib.jsObjPrefix]&&window[lib.aktPid+lib.jsObjPrefix].deinit){window[lib.aktPid+lib.jsObjPrefix].deinit();}
lib.contentBox.innerHTML="";jsl.addClass(gMainBox,"no_content");jsl.unloadCss();lib.delRefreshTimers();tmp=jsl.get(lib.aktPid+"_js");if(tmp&&"object"===typeof tmp){gHead.removeChild(tmp);}}else{oldPage.unload(lib.contentBox);}
tmpDelMenuPid=lib.aktPid;lib.aktPid=pid;while(lib.aktPid&&lib.menu[lib.aktPid]&&!lib.pages[lib.aktPid]){if(lib.menu[lib.aktPid].sub){lib.aktPid=getSmallestPos(lib.menu[lib.aktPid].sub);}else if(lib.menu[lib.aktPid].tab){lib.aktPid=getSmallestPos(lib.menu[lib.aktPid].tab);}}
gRefreshParams=addParams||null;if(lib.aktPid&&lib.pages[lib.aktPid]&&lib.pages[lib.aktPid].js){delMenu(tmpDelMenuPid);setMenu(lib.aktPid);lang="?"+encodeURIComponent("lang")+"="+encodeURIComponent(lib.lang);html2.add(gHead,html2.script({src:lib.pages[lib.aktPid].js+lang,id:lib.aktPid+"_js",onload:function(){if(jsPid===lib.aktPid&&window[jsPid+lib.jsObjPrefix]&&window[jsPid+lib.jsObjPrefix].init){jsl.log("add timestamp new");lib.delContent();window[jsPid+lib.jsObjPrefix].init(jsPid,addParams);}},onerror:function(){lib.changePage(null,tmpDelMenuPid);}}));jsPid=lib.aktPid;}else{if(lib.aktPid){delMenu(tmpDelMenuPid);setMenu(lib.aktPid);}else{delTabs();}
loadOldpage(lib.aktPid,addParams);}
setBreadcrump(lib.aktPid);closeAllMenu();lib.showTabScroll(gTabMenu.children[0].offsetWidth<gTabMenu.children[0].scrollWidth);}};lib.refreshAktPage=function(){lib.changePage(null,(!gRefreshParams&&lib.aktPid)||null,true,gRefreshParams);};function setTimerTxt(){var txt="",min=Math.floor(gPageTimer.time/60);if(0<min){txt+=" "+min+"m";}
txt+=" "+gPageTimer.time%60+"s";jsl.setText(gPageTimer.txtElem,txt);gPageTimer.time-=1;}
lib.resetPageTimer=function(){if(gPageTimer.displayInterval){window.clearInterval(gPageTimer.displayInterval);}
gPageTimer.time=1200;if("private"===config.gu_type){gPageTimer.time=28800;}
if(gUsePwd){setTimerTxt();gPageTimer.displayInterval=window.setInterval(function(){if(0>=gPageTimer.time){doLogout();}else{window.requestAnimationFrame(function(){setTimerTxt();});}},1000);}else{jsl.setText(gPageTimer.txtElem,"");}};lib.setUsePwd=function(usePwd){gUsePwd=usePwd===true;lib.resetPageTimer();};function createFooter(){html2.add(lib.menuBox,html2.div({id:"menuFooter","class":"footer"},(lib.menu.expert&&html2.a({id:"menuFooterViewLnk",onclick:function(evt){setExpertMode();return jsl.stopDefaultBubbling(evt);},href:"/?sid="+encodeURIComponent(lib.sid)+"&lp="+encodeURIComponent("expert"),role:"button"},gExpertTxt[lib.menu.expert.state.toString()]))||null,html2.a({href:"/?sid="+encodeURIComponent(lib.sid)+"&lp="+encodeURIComponent("sitemap"),onclick:function(evt){main.changePage(null,"sitemap");return jsl.stopDefaultBubbling(evt);}},"Inhalt"),html2.a({href:lib.manUrl,"class":"nocancel",target:"_blank"},"Handbuch"),("de"===lib.lang&&html2.a({href:lib.serviceUrl,"class":"nocancel",target:"_blank"},"Tipps & Tricks"))||null,("de"===lib.lang&&html2.a({href:lib.newsUrl,"class":"nocancel",target:"_blank"},"Newsletter"))||null,html2.a({href:lib.avmUrl,"class":"nocancel",target:"_blank"},"avm.de")));}
lib.getRemPx=function(){if(!gRemPxDiv||!gRemPxDiv.offsetWidth){gRemPxDiv=document.createElement("div");gRemPxDiv.style.width="1rem";gMainBox.appendChild(gRemPxDiv);}
return gRemPxDiv.offsetWidth||16;};lib.getLastPid=function(){return(-1<(gLastPids.length-2)&&gLastPids[gLastPids.length-2])||"overview";};lib.showPrintView=function(){jsl.addClass(gHtmlTag,"printView");privateHistory.addToHistory(lib.closePrintView,[]);html2.printViewButtons(jsl.get("btn_form_foot")||jsl.getByClass("btn_form_foot",lib.contentBox,"div")[0]);};lib.closePrintView=function(){var btnBox=jsl.get("btn_form_foot")||jsl.getByClass("btn_form_foot",lib.contentBox,"div")[0],printBtn=jsl.get("uiDoPrintBtn"),closeBtn=jsl.get("uiClosePrintView");if(btnBox){if(printBtn){btnBox.removeChild(printBtn);}
if(closeBtn){btnBox.removeChild(closeBtn);}}
jsl.removeClass(gHtmlTag,"printView");};function loadInitJs(){if(config.GUI_IS_REPEATER){require("/js/bridge_graphics.js");}}
lib.init=function(data){var selectedItems=null,date,setExpert,timeXhr,tmp,ignoreNextRefreshKeyup=false,menuArray=[];lib.pages=data.pages||{};lib.menu=data.menu||{};lib.aktPid=data.aktPid||"";lib.pidParams=data.pidParams||"";lib.oauthCode=data.oauthCode||null;lib.oauthError=data.oauthError||null;lib.dbgCache=data.dbg||null;if(Array.isArray(data.dbg)&&data.dbg.length===0){lib.dbgCache={};}
lib.sid=data.sid||"";lib.fromInternet=data.fromInternet||false;lib.lang=data.lang||"en";lib.manUrl=data.manUrl||"";lib.serviceUrl=data.serviceUrl||"";lib.newsUrl=data.newsUrl||"";lib.avmUrl=data.avmUrl||"";gUsePwd=data.usePwd||false;gBoxType=data.boxType||"";gBoxName=data.boxName||"";gUsername=data.username||"";lib.menuBox=jsl.get("menuBox");gNavMenu=jsl.get("navigationMenu");gAvmLogo=jsl.get("avmLogo");gUserLogo=jsl.get("userLogo");gUserMenuBox=jsl.get("userMenuBox");gUserMenu=jsl.get("userMenu");gBlueBarBox=jsl.get("blueBarBox");gBlueBarRightBox=jsl.get("blueBarRightBox");gBlueBarTitle=jsl.get("blueBarTitel");gMainBox=jsl.get("contentBox");lib.contentBox=jsl.get("content");gHelpBtnBox=jsl.get("contextHelp");gDisablePage=jsl.get("disablePage");gTabMenu=jsl.get("tabMenu");gBtnMenu=jsl.get("bottomMenu");gBreadCrump=jsl.get("uiPageTitleBox");gFallback=jsl.get("fallback");gHead=document.getElementsByTagName("head")[0];if(data.setBoxTime){date=new Date();timeXhr=http.request({method:"POST",url:"/post.lua",params:{settime:String(Math.floor(date.getTime()/1000))+","+String(date.getTimezoneOffset()),sid:lib.sid}});timeXhr.start();}
if(lib.menuBox&&gNavMenu&&gAvmLogo&&gUserLogo&&gUserMenuBox&&gUserMenu&&gBlueBarBox&&gBlueBarRightBox&&gBlueBarTitle&&gMainBox&&lib.contentBox&&gDisablePage&&gTabMenu&&gBtnMenu&&gBreadCrump&&gFallback&&gHelpBtnBox){window.history.replaceState({},'','/');jsl.catchPulldownRefresh();jsl.removeClass(lib.menuBox,"hidden");jsl.removeClass(gBlueBarBox,"hidden");jsl.removeClass(gMainBox,"hidden");jsl.removeClass(gTabMenu,"hidden");jsl.removeClass(gBtnMenu,"hidden");jsl.removeClass(gBreadCrump,"hidden");jsl.removeClass(gUserMenuBox,"hidden");gFallback.innerHTML="";loadInitJs();if(lib.menu){gCheckedTabRoots={};Object.keys(lib.menu).forEach(function(pid){if(pid&&lib.menu[pid]&&!lib.menu[pid].par){menuArray.push(lib.menu[pid]);menuArray[menuArray.length-1].pid=pid;}});menuArray.sort(function(first,second){if(first.pos>second.pos){return 1;}
if(first.pos<second.pos){return-1;}
return 0;});menuArray.forEach(function(elem){createMenuItem({pid:elem.pid});setMenuItemVisibility(elem.pid);});}
createFooter();if(lib.aktPid&&"expert"===lib.aktPid){setExpert=true;lib.aktPid=null;}
if(lib.aktPid&&lib.menu[lib.aktPid]&&!lib.pages[lib.aktPid]){lib.aktPid=pidExistsAndShown(lib.aktPid);}
lib.aktPid=(lib.aktPid&&lib.pages[lib.aktPid])?lib.aktPid:"overview";lib.changePage(null,lib.aktPid,null,lib.pidParams);tmp=jsl.get("blueBarLogo");if(tmp){tmp.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);blueBarMainMenuClick(evt);},false);}
tmp=jsl.get("blueBarUserMenuIcon");if(tmp){tmp.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);blueBarUserMenuClick(evt);},false);}
gBlueBarTitle.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);changeBlueBarHeadline(evt);},false);gHelpBtnBox.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);helpPopup();},false);gAvmLogo.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);if(window.matchMedia("(min-width:1024px)").matches){lib.changePage(null,"overview");}else{closeAllMenu();}},false);gUserLogo.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);closeAllMenu();},false);lib.menuBox.addEventListener("click",function(evt){if(evt.target===lib.menuBox){jsl.stopDefaultBubbling(evt);closeAllMenu();}},false);gUserMenuBox.addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);closeAllMenu();},false);gDisablePage.addEventListener("click",function(evt){if(!jsl.hasClass(gDisablePage,"logout")){jsl.stopDefaultBubbling(evt);}
closeAllMenu();},false);gDisablePage.addEventListener("touchmove",function(evt){if(!jsl.hasClass(gDisablePage,"logout")){jsl.stopDefaultBubbling(evt);}
closeAllMenu();},false);gMainBox.addEventListener("click",function(){selectedItems=jsl.getByClass("selected",gNavMenu);Object.keys(selectedItems).forEach(function(idx){if((jsl.hasClass(selectedItems[idx],"with_sub")&&!jsl.hasClass(selectedItems[idx],"open"))||(lib.menu[lib.aktPid]&&!lib.menu[lib.aktPid].par)){showSelectedMenu(true);}});lib.scrollSelectedTabIntoView();},false);window.addEventListener("scroll",function(){window.requestAnimationFrame(function(){lib.showTabScroll(gTabMenu.children[0].offsetWidth<gTabMenu.children[0].scrollWidth);if((gBodyTag&&0!==gBodyTag.scrollTop)||(gBodyTag.parentNode&&0!==gBodyTag.parentNode.scrollTop)){jsl.addClass(gBodyTag,"stickyTop");}else if(jsl.hasClass(gBodyTag,"stickyTop")){jsl.removeClass(gBodyTag,"stickyTop");}
lib.footBtnSticky();});},false);gTabMenu.children[0].addEventListener("scroll",function(){window.requestAnimationFrame(function(){lib.showTabScroll(gTabMenu.children[0].offsetWidth<gTabMenu.children[0].scrollWidth);});},false);window.addEventListener("resize",function(){window.requestAnimationFrame(function(){lib.showTabScroll(gTabMenu.children[0].offsetWidth<gTabMenu.children[0].scrollWidth);lib.footBtnSticky();});},false);gTabMenu.children[1].addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.smoothScrollTo(gTabMenu.children[0],-220,0,true);},false);gTabMenu.children[2].addEventListener("click",function(evt){jsl.stopDefaultBubbling(evt);lib.smoothScrollTo(gTabMenu.children[0],220,0,true);},false);window.addEventListener("keydown",function(evt){if(116===evt.keyCode||(82===evt.keyCode&&evt.ctrlKey)){jsl.stopDefaultBubbling(evt);evt.returnValue=false;return false;}
if(82===evt.keyCode&&!evt.ctrlKey){ignoreNextRefreshKeyup=true;}},false);window.addEventListener("keyup",function(evt){if(116===evt.keyCode||(!ignoreNextRefreshKeyup&&82===evt.keyCode&&evt.ctrlKey)){jsl.stopDefaultBubbling(evt);evt.returnValue=false;lib.refreshAktPage();return false;}
ignoreNextRefreshKeyup=false;},false);if(setExpert){setExpertMode();}
lib.resetPageTimer();}};return lib;}());
var newval,html2,twofactor;newval=newval||(function(){"use strict";var lib,cfg,active;lib={};cfg={};function copyParams(params){var result;result={};Object.keys(params||{}).forEach(function(key){result[key]=params[key];});return result;}
function setSubmitting(on){if(on===true){html2.add(jsl.get("content"),html2.div({class:"disableContent"}))}else if(on===false){jsl.removeElements(jsl.find("main div.disableContent"));}}
function showSaveerror(saveerror){var parent;parent=jsl.findFirst("#content");if(parent){parent.insertBefore(html2.saveErrorMsg(saveerror),parent.firstChild);}}
function hideSaveerror(){jsl.removeElements(jsl.find(".LuaSaveVarError"));}
function onFocus(evt){var elem;elem=jsl.evtTarget(evt);jsl.removeClass(elem,"error");jsl.removeEventHandler(elem,"focus",onFocus);}
function onFocusIdx(evt){var elem,name,els;elem=jsl.evtTarget(evt);name=elem.name.replace(/\d+$/,"");els=jsl.find("[name^="+name+"]");els.forEach(function(el){jsl.removeClass(el,"error");jsl.removeEventHandler(el,"focus",onFocusIdx);});}
function setValError(toMark){var scrolled;toMark=toMark||[];if(!Array.isArray(toMark)){toMark=[toMark];}
toMark.forEach(function(name){var els,i;if(name){els=jsl.find("[name="+name+"]");i=els.length;jsl.log("setValError",name,i,els);if(i===0){els=jsl.find("[name^="+name+"]");els.forEach(function(el){jsl.addClass(el,"error");jsl.addEventHandler(el,"focus",onFocusIdx);});}else{els.forEach(function(el){jsl.addClass(el,"error");jsl.addEventHandler(el,"focus",onFocus);});}
if(!scrolled&&els[0]){jsl.scrollIntoView(els[0]);scrolled=true;}}});}
function clearValErrors(){jsl.find(".error",jsl.findFirst("#content")).forEach(function clearValError(el){jsl.removeClass(el,"error");});}
function ask(questions){var i,len;questions=questions||[];if(!Array.isArray(questions)){questions=[questions];}
i=0;len=questions.length;while(i<len){if(!window.confirm(questions[i])){return false;}
i=i+1;}
return true;}
function createCallback(submitName,params,onAfterSubmit,onSaveerror){params=params||{};onAfterSubmit=onAfterSubmit||cfg.updatePage;onSaveerror=onSaveerror||func.id;return function submitCallback(answer){var data,confirmed;answer=answer||{};data=answer.data||{};jsl.log("callback",submitName,data[submitName],active,data);if(active){setSubmitting(false);clearValErrors();hideSaveerror();switch(data[submitName]){case"confirm":confirmed=ask(data.confirm);if(confirmed){params.confirmed="";lib.submit(submitName,params,onAfterSubmit,onSaveerror);}
break;case"valerror":setValError(data.tomark);if(data.alert){window.alert(data.alert);}
break;case"twofactor":jsl.log("twofactor",data);params.confirmed="";params.twofactor="";twofactor.run(data.twofactor,lib.submit.bind(null,submitName,params,onAfterSubmit,onSaveerror));break;case"saveerror":showSaveerror(onSaveerror(data.saveerror));break;case"ok":if(data.redirect){main.changePage(null,data.redirect.page,false,data.redirect.params);}else{onAfterSubmit(data);}
break;}}};}
lib.init=function(args){args=args||{};if(!args.pid&&!args.script){return;}
cfg.pid=args.pid;cfg.script=args.script;cfg.oldpage=args.oldpage;cfg.updatePage=args.updatePage||func.noop;if(cfg.oldpage&&!args.updatePage){cfg.updatePage=main.changePage.bind(null,null,cfg.pid,false,null);}
active=true;};lib.deinit=function(){cfg.updatePage=func.noop;active=false;};lib.submit=function(submitParam,params,onAfterSubmit,onSaveerror){var url,submitName,submitValue;if(submitParam){switch(typeof submitParam){case'string':submitName=submitParam;break;case'object':submitName=submitParam.name;submitValue=submitParam.value;break;}}
params=params||{};params=http.collectParams(jsl.findFirst("#content"),params);params=http.collectParams(jsl.findFirst(".modelMsgBox"),params);if(params[submitName]===undefined){params[submitName]=submitValue||"";}
if(cfg.script){url=cfg.script;}else{url="data.lua";}
if(main.sid){params.sid=main.sid;}
if(main.lang){params.lang=main.lang;}
if(cfg.pid){params.page=cfg.pid;}
jsl.log("newval.submit",submitName,submitValue,url,params,onAfterSubmit);setSubmitting(true);http.request({method:"POST",url:url,type:'json',sidRenew:true,params:{},callback:createCallback(submitName,params,onAfterSubmit,onSaveerror)}).start(params);};lib.createSubmitHandler=function(options){var submitParams,onBeforeSubmit;options=options||{};onBeforeSubmit=options.onBeforeSubmit||func.noop;submitParams=options.submitParams||{};return function submithandler(evt){var elem;elem=jsl.eventTarget(evt,"[name="+options.name+"]");if(elem){if(onBeforeSubmit(evt)!==false){newval.submit({name:options.name,value:elem.value},submitParams,options.onAfterSubmit,options.onSaveerror);}
return jsl.cancelEvent(evt);}};};lib.addSubmitHandler=function(options){var selector;if(!options.name){return;}
selector="[name="+options.name+"]";jsl.find(selector,jsl.get("content")).forEach(function(el){jsl.addEventHandler(el,"click",lib.createSubmitHandler(options));});};return lib;}());
var jsl,dialog;dialog=dialog||(function(){"use strict";var lib={},gOverlayElem=null,gDialogElem=null;function overlay(){var body=document.getElementsByTagName("main")[0];if(!body){body=document.body||document.getElementsByTagName("body")[0];}
if(!gOverlayElem){gOverlayElem=document.createElement("div");gOverlayElem.setAttribute('class','modalMsgBoxOverlay');body.appendChild(gOverlayElem);gDialogElem=document.createElement('div');gDialogElem.setAttribute('class','modelMsgBox selectable');gOverlayElem.appendChild(gDialogElem);}else{jsl.addClass(gOverlayElem,"show");gDialogElem.innerHTML="";}}
function closeBox(){if(gDialogElem){gDialogElem.innerHTML="";}
if(gOverlayElem){jsl.removeClass(gOverlayElem,"show");}}
function addButton(count,txt,contentJson){var button=document.createElement("button"),buttontext=document.createTextNode(txt);button.setAttribute("type",'button');button.setAttribute("id",'Button'+count);button.setAttribute("name",'button'+count);jsl.addEventHandler(button,'click',function(){lib.msgBox(false,contentJson,txt);});button.appendChild(buttontext);return button;}
function createIcon(src){var img;img=document.createElement('img');img.setAttribute('class','icon');img.setAttribute("src",src||"");return img;}
function content(elem,contentJson){var imageSpan=document.createElement('span'),buttonDiv,buttonCount=1,idx=1,textVar="Text"+idx,text=null,divText=null,addClassVar=null,button=null,i=0,divHtml,icon=null,divDom;imageSpan.setAttribute('class','imagearea');while(undefined!==contentJson[textVar]){text=document.createTextNode(contentJson[textVar]);divText=document.createElement('div');if(1===idx){jsl.addClass(divText,"head");}
addClassVar="AddClass"+idx;if(contentJson[addClassVar]){jsl.addClass(divText,contentJson[addClassVar]);}
divText.setAttribute('id','TextArea'+idx);if(1===idx&&undefined!==contentJson.Icon&&null!==contentJson.Icon){divText.appendChild(createIcon(contentJson.Icon));}
divText.appendChild(text);elem.appendChild(divText);idx+=1;textVar="Text"+idx;}
if(contentJson.Dom){divDom=document.createElement('div');divDom.appendChild(contentJson.Dom);elem.appendChild(divDom);}
if(undefined!==contentJson.Buttons){buttonDiv=document.createElement('div');buttonDiv.setAttribute('class','buttonsarea');for(i=0;i<contentJson.Buttons.length;i+=1){button=addButton(buttonCount,contentJson.Buttons[i].txt,contentJson);buttonDiv.appendChild(button);buttonCount+=1;}}
if(undefined!==contentJson.Html){divHtml=document.createElement('div');jsl.setHtml(divHtml,contentJson.Html);elem.appendChild(divHtml);}
elem.appendChild(imageSpan);if(buttonDiv){elem.appendChild(buttonDiv);}}
lib.messagebox=function(display,contentJson,txt){lib.msgBox(display,contentJson,txt);};lib.msgBox=function(display,contentJson,txt){var i=0;if(!display){if(contentJson.Buttons){for(i=0;i<contentJson.Buttons.length;i+=1){if(undefined!==contentJson.Buttons[i].cb&&txt===contentJson.Buttons[i].txt){contentJson.Buttons[i].cb(contentJson.Buttons[i].val);}
if(contentJson.Buttons[i].dialog&&txt===contentJson.Buttons[i].txt){return false;}}
closeBox();}}else{overlay();content(gDialogElem,contentJson);jsl.addClass(gOverlayElem,"show");return false;}};lib.confirm=function(headlineTxt,contentTxt,callback){var alertJson={Text1:headlineTxt,Text2:contentTxt,AddClass1:"subtitle",AddClass2:"textarea","Buttons":[{txt:"OK",cb:callback},{txt:"Abbrechen"}]};lib.msgBox(true,alertJson);};lib.query=function(headlineTxt,contentTxt,callback){var alertJson={Text1:headlineTxt,Text2:contentTxt,AddClass1:"subtitle",AddClass2:"textarea","Buttons":[{txt:"Ja",cb:callback,val:"yes"},{txt:"Nein",cb:callback,val:"no"}]};lib.msgBox(true,alertJson);};lib.alert=function(txt,icon,cb){var alertJson={Text1:txt,"Buttons":[{txt:"OK",cb:cb}]};if(undefined!==icon&&null!==icon){alertJson.Icon=icon;}
dialog.msgBox(true,alertJson);};lib.close=function(){closeBox();};return lib;}());
var twofactor,dialog,html2,http,jsl,main;twofactor=twofactor||(function(){"use strict";var lib,doSubmit,doSubmitAgain,pollState,stopPolling;lib={};function splitState(state){jsl.log("splitState",state);var result,s,i;result={};s=(state||"").split(";");result.code=s[1];s=s[0].split(",");i=s.length;while(i>0){i-=1;result[s[i]]=true;}
return result;}
function cancelAuth(){stopPolling=true;pollState.stop();http.request({method:"POST",url:"/twofactor.lua",type:'json',params:{sid:main.sid,tfa_cancel:""}}).start();}
function buildTfInfo(data){var tfInfo;tfInfo=html2.div({class:"hide",id:"uiTFInfo"});if(data.dtmf&&data.code){html2.add(tfInfo,html2.h4({},"Geeignete Telefone:"),"Verwenden Sie zur Bestätigung ein geeignetes Telefon (analog, ISDN oder DECT).");html2.add(tfInfo,html2.h4({},"Kein geeignetes Telefon vorhanden:"),"Sollten Sie kein geeignetes Telefon zur Verfügung haben, können Sie die Ausführung auch über einen der Taster an Ihrer FRITZ!Box bestätigen:",html2.ul({class:"hintlist"},html2.li({},"Drücken Sie kurz eine beliebige Taste an der FRITZ!Box"),html2.li({},"Zur Bestätigung der Ausführung blinken die LEDs an der FRITZ!Box einmal auf.")));}
html2.add(tfInfo,html2.h4({},"Bestätigung deaktivieren:"),html2.printf("Die Option \"Ausführung bestimmter Einstellungen und Funktionen zusätzlich bestätigen\" kann im Bereich \"%1\" bearbeitet werden.",html2.internLink({pid:"userSet",noLink:true})));return html2.fragment(html2.toggleLink({closedText:"Weitere Informationen zur Funktion der Bestätigung",destination:"#uiTFInfo"}),html2.br(),tfInfo);}
function buildStartDlgContent(data){var result;result=html2.div({class:"formular"});if(data.dtmf&&data.code){html2.add(result,html2.ol({},html2.li({},"Nehmen Sie ein an der FRITZ!Box angeschlossenes Telefon zur Hand."),html2.li({},"Geben Sie ein:",html2.span({class:"tfa_code"},"*1",data.code)),html2.li({},"Bestätigen Sie Ihre Eingabe mit der Verbindungstaste."),html2.li({},"Hören Sie einen Quittungston und legen auf.")));}else if(data.button){html2.add(result,html2.ol({},html2.li({},"Drücken Sie kurz eine beliebige Taste an der FRITZ!Box."),html2.li({},"Die LEDs an der FRITZ!Box blinken einmal auf.")));}
html2.add(result,buildTfInfo(data));return result;}
function dlgStart(data){dialog.messagebox(true,{Text1:"Bestätigen",AddClass1:"subtitle",Text2:"Die Ausführung muss zusätzlich bestätigt werden.",AddClass2:"formular",Dom:buildStartDlgContent(data),Buttons:[{txt:"Abbrechen",cb:cancelAuth}]});}
function dlgSuccess(){dialog.messagebox(true,{Icon:"/css/default/images/icon_success.png",Text1:" Ausführung bestätigt",AddClass1:"subtitle",Text2:"Klicken Sie auf \"OK\", um den Vorgang abzuschließen.",AddClass2:"formular",Buttons:[{txt:"OK",cb:doSubmit},{txt:"Abbrechen"}]});}
function dlgFailure(){dialog.messagebox(true,{Icon:"/css/default/images/icon_warning.png",Text1:"Ausführung wurde nicht bestätigt",AddClass1:"subtitle",Text2:"Für einen erneuten Versuch klicken Sie bitte auf \"Wiederholen\".",AddClass2:"formular",Buttons:[{txt:"Wiederholen",cb:doSubmitAgain?doSubmitAgain:doSubmit},{txt:"Abbrechen"}]});}
function dlgStartFailureDos(){dialog.messagebox(true,{Icon:"/css/default/images/icon_warning.png",Text1:"Ausführung nicht möglich",AddClass1:"subtitle",Text2:"Die letzten drei Bestätigungsversuche wurden abgebrochen oder nicht erfolgreich ausgeführt. Der Bestätigungsvorgang wurde zum Schutz für 60 Minuten gesperrt. Bitte versuchen Sie es später noch einmal.",AddClass2:"formular",Buttons:[{txt:"OK"}]});}
function dlgStartFailureOtherSession(){dialog.messagebox(true,{Icon:"/css/default/images/icon_warning.png",Text1:"Bestätigung derzeit nicht möglich",AddClass1:"subtitle",Text2:"Die Ausführung kann derzeit nicht bestätigt werden, da bereits ein Bestätigungsvorgang aktiv ist. Bitte versuchen Sie es in zwei Minuten noch einmal.",AddClass2:"formular",Buttons:[{txt:"OK"}]});}
function onState(answer){if(stopPolling){return;}
answer=answer||{};if(answer.done){if(answer.active){dlgSuccess();}else{dlgFailure();}}else{window.setTimeout(pollState.start,1000);}}
lib.run=function run(state,submitFunc){var data,error;data=splitState(state);doSubmit=submitFunc;pollState=http.request({method:"POST",url:"/twofactor.lua",type:'json',params:{sid:main.sid,tfa_active:""},callback:onState});stopPolling=false;if(data.dtmf&&data.code||data.button){dlgStart(data);pollState.start();}else if(data.starterror){error=parseInt(data.code||"",10);if(error===91){dlgStartFailureOtherSession();}else if(error===92){dlgStartFailureDos();}else{dlgFailure();}}else{dlgFailure();}};lib.startAndRun=function startAndRun(submitFunc){doSubmitAgain=function(){lib.startAndRun(submitFunc);};http.request({method:"POST",url:"/twofactor.lua",type:'json',params:{sid:main.sid,tfa_start:""},callback:function cb(answer){answer=answer||{};lib.run(answer.state,submitFunc);}}).start();};return lib;}());
var jxl,config;function sorter(){var lib={},direction=[],cmp_func=[],get_func=[],post_func=0,tMain=[],cur_col=0,elem_node=document.ELEMENT_NODE,text_node=document.TEXT_NODE;tMain[0]=0;if(document.ELEMENT_NODE===null){elem_node=1;text_node=3;}
function getClass(obj){if(!obj){return"";}
return obj.className||"";}
function getTextValue(obj){var s,i,len;if(!obj){return"";}
s="";for(i=0,len=obj.childNodes.length;i<len;i+=1){if(obj.childNodes[i].nodeType===text_node){s+=obj.childNodes[i].nodeValue;}else if(obj.childNodes[i].nodeType===elem_node&&obj.childNodes[i].tagName==="BR"){s+=" ";}else{if(obj.childNodes[i].tagName!=="TABLE"){s+=getTextValue(obj.childNodes[i]);}}}
return s;}
function getNumValue(obj){var val;if(!obj){return"";}
val=getTextValue(obj);return parseFloat(val)||0;}
function getMyValue(obj){var val;if(!obj){return"";}
val=obj.getAttribute("data-timestr")||"";return val;}
function getDateValue(obj){var val,date,time,time_stamp,buf,month;if(!obj){return"";}
val=getTextValue(obj);date=val.split('.');buf=date[2].split(' ');if(buf[1]){date[2]=buf[0];time=buf[1].split(':');}
month=date[1]-1;if(month<0){month=0;}
if(time.length>0){time_stamp=new Date(date[2],month,date[0],time[0],time[1]).getTime()||0;}else{time_stamp=new Date(date[2],month,date[0]).getTime()||0;}
return time_stamp;}
function getTimeValue(obj){var val,time,time_stamp,buf;if(!obj){return"";}
val=getMyValue(obj);time=val.split(':');if(time.length>0){switch(time.length){default:case 1:time_stamp=parseFloat(time[0])||0;break;case 2:time_stamp=(parseFloat(time[0])||0)*60+(parseFloat(time[1])||0);break;case 3:time_stamp=(parseFloat(time[0])||0)*3600+(parseFloat(time[1])||0)*60+(parseFloat(time[2])||0);break;}}else{time_stamp=parseFloat(time[0])||0;}
return time_stamp;}
function comp_as_num(v1,v2){if(v1===v2){return 0;}
if(v1>v2){return 1;}
return-1;}
function comp_as_str_nocase(v1,v2){v1=v1.toLowerCase();v2=v2.toLowerCase();if(v1===v2){return 0;}
if(v1>v2){return 1;}
return-1;}
lib.init=function(IdOrElement){var th,max_col,i,len;function getFunc(th){if(jxl.hasClass(th,"sort_by_class")){return getClass;}
if(jxl.hasClass(th,"sort_by_utf8")){return getTextValue;}
if(jxl.hasClass(th,"sort_by_num")){return getNumValue;}
if(jxl.hasClass(th,"sort_by_date")){return getDateValue;}
if(jxl.hasClass(th,"sort_by_time")){return getTimeValue;}
if(jxl.hasClass(th,"sort_by_func")){if(typeof retrieveFunc==="function"){return retrieveFunc(th.getAttribute("func"))||getTextValue;}}
return getTextValue;}
function cmpFunc(th){if(jxl.hasClass(th,"sort_by_num")){return comp_as_num;}
if(jxl.hasClass(th,"sort_by_date")){return comp_as_num;}
if(jxl.hasClass(th,"sort_by_time")){return comp_as_num;}
return comp_as_str_nocase;}
tMain[0]=jxl.get(IdOrElement);if(!tMain[0]){return false;}
th=tMain[0].tBodies[0].rows[0].cells;max_col=th.length;direction=new Array(max_col);for(i=0,len=direction.length;i<len;i+=1){direction[i]=1;if(jxl.hasClass(th[i],"sortable")){cmp_func[i]=cmpFunc(th[i]);get_func[i]=getFunc(th[i]);jxl.addEventHandler(th[i],"click",(function(idx){return function(){lib.sort_table(idx);};}(i)));}else{cmp_func[i]=0;get_func[i]=0;}}
return true;};lib.addPostFunc=function(func){if(typeof func==="function"){post_func=func;}
return false;};lib.addTbl=function(IdOrElement){var freeId,newTbl;freeId=tMain.length;newTbl=jxl.get(IdOrElement);if(!newTbl){return false;}
tMain[freeId]=newTbl;return true;};lib.setDirection=function(col,dir){if(col>=0&&col<=direction.length){direction[col]=(dir===1)?1:-1;}};lib.getDirection=function(col){if(col>=0&&col<=direction.length){return direction[col];}};lib.get_sortcol=function(){return cur_col;};lib.sort_table_again=function(col){var x,i,len,len2,TblBody;if(col>=0&&col<=direction.length){for(x=0,len=tMain.length;x<len;x+=1){if(tMain[x]&&tMain[x].tBodies){for(i=0,len2=tMain[x].tBodies.length;i<len2;i+=1){TblBody=tMain[x].tBodies[i];lib.sort_body(TblBody,col);}}}
return true;}
return false;};lib.sort_table=function(col){var x,i,len,len2,TblBody;if(col>=0&&col<=direction.length){if(direction[col]){direction[col]*=-1;}
for(x=0,len=tMain.length;x<len;x+=1){if(tMain[x]&&tMain[x].tBodies){for(i=0,len2=tMain[x].tBodies.length;i<len2;i+=1){TblBody=tMain[x].tBodies[i];lib.sort_body(TblBody,col);}}}
return true;}
return false;};lib.sort_body=function(TblBody,col){var tmpObj,i,len,j,len2,curVal,curIdx,testVal,res,rev=direction[col]||1;if(!get_func[col]){return false;}
cur_col=col;function resetTblHeader(TblHeadRow){var count_col=0,ii,kk,llen,llen2,th_elem,span_elem;for(ii=0,llen=TblHeadRow.childNodes.length;ii<llen;ii+=1){th_elem=TblHeadRow.childNodes[ii];if(th_elem&&th_elem.nodeType!==text_node){for(kk=0,llen2=th_elem.childNodes.length;kk<llen2;kk+=1){span_elem=th_elem.childNodes[kk];if(span_elem&&span_elem.nodeName==="SPAN"){if(count_col===col){jxl.overwriteClass(span_elem,(direction[col]===1)?"sort_up":"sort_down");}else{jxl.overwriteClass(span_elem,"sort_no");}
break;}}
count_col+=1;}}}
for(i=0,len=TblBody.rows.length;i<=len-1;i+=1){if(TblBody.rows[i].className==="thead"){resetTblHeader(TblBody.rows[i]);continue;}
if(TblBody.rows[i].className==="separator"){continue;}
curIdx=i;curVal=get_func[col](TblBody.rows[i].cells[col]);for(j=i+1,len2=TblBody.rows.length;j<len2;j+=1){testVal=get_func[col](TblBody.rows[j].cells[col]);res=rev*cmp_func[col](curVal,testVal);if(res>0){curIdx=j;curVal=testVal;}}
if(curIdx>i){tmpObj=TblBody.removeChild(TblBody.rows[curIdx]);TblBody.insertBefore(tmpObj,TblBody.rows[i]);}}
if(post_func){return post_func();}
return false;};return lib;}
var func,html2,jsl;function require(){"use strict";var callback,errors,i,len,scripts,next,handler;next=function(){if(scripts.length>0){if(jsl.findFirst("script[src=\""+scripts[0]+"\"]")){handler({type:"found"});}else{html2.add(document.head,html2.script({src:scripts[0],onload:handler,onerror:handler}));}}else if(callback){callback(errors);}};handler=function(evt){var script;script=scripts.shift();if(evt.type==="error"){errors.push(script);}
next();};scripts=[];errors=[];len=arguments.length;for(i=0;i<len;i+=1){scripts.push(arguments[i]);}
next();return function(fn){callback=func.once(fn);if(scripts.length===0){callback(errors);}};}
var ready;ready=ready||(function(){"use strict";var lib,funcs,later;lib={};funcs=[];later=true;lib.onReady=function(f){if(later){funcs.push(f);}else{f();}};lib.run=function(){var f;while(funcs.length>0){f=funcs.shift();f();}
later=false;};lib.reset=function(){funcs.length=0;later=true;};lib.onReadyPopup=function(f){lib.onReady(f);if(later&&document.addEventListener){document.addEventListener("DOMContentLoaded",lib.run,false);}};return lib;}());
